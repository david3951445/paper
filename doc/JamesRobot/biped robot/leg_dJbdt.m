function dJbdt = leg_dJbdt(dthdt,th,L4,L5)

dJbdt = [                                                                                                                                                                                                                                                                                                                                                                                   0,                     sin(th(2))*(L4*cos(th(6))*dthdt(6) + L5*cos(th(6) + th(8))*dthdt(6) + L5*cos(th(6) + th(8))*dthdt(8)) + cos(th(2))*(L4*sin(th(6)) + L5*sin(th(6) + th(8)))*dthdt(2) + cos(th(2))*sin(th(4))*(L5*sin(th(6) + th(8))*dthdt(6) + L5*sin(th(6) + th(8))*dthdt(8) + L4*sin(th(6))*dthdt(6)) - cos(th(2))*cos(th(4))*(L5*cos(th(6) + th(8)) + L4*cos(th(6)))*dthdt(4) + sin(th(2))*sin(th(4))*(L5*cos(th(6) + th(8)) + L4*cos(th(6)))*dthdt(2),                                                                                                                                                                                                                                     0,                cos(th(4))*sin(th(2))*(L5*sin(th(6) + th(8))*dthdt(6) + L5*sin(th(6) + th(8))*dthdt(8) + L4*sin(th(6))*dthdt(6)) - cos(th(2))*cos(th(4))*(L5*cos(th(6) + th(8)) + L4*cos(th(6)))*dthdt(2) + sin(th(2))*sin(th(4))*(L5*cos(th(6) + th(8)) + L4*cos(th(6)))*dthdt(4),                                                                                                                                                                                                                                                                                                                                                                                    0,                     cos(th(2))*(L5*sin(th(6) + th(8))*dthdt(6) + L5*sin(th(6) + th(8))*dthdt(8) + L4*sin(th(6))*dthdt(6)) + sin(th(2))*(L5*cos(th(6) + th(8)) + L4*cos(th(6)))*dthdt(2) + sin(th(2))*sin(th(4))*(L4*cos(th(6))*dthdt(6) + L5*cos(th(6) + th(8))*dthdt(6) + L5*cos(th(6) + th(8))*dthdt(8)) + cos(th(2))*sin(th(4))*(L4*sin(th(6)) + L5*sin(th(6) + th(8)))*dthdt(2) + cos(th(4))*sin(th(2))*(L4*sin(th(6)) + L5*sin(th(6) + th(8)))*dthdt(4),                                                                                                                                                                                                                                               0,              L5*sin(th(2))*cos(th(6) + th(8))*dthdt(2) + L5*cos(th(2))*sin(th(6) + th(8))*(dthdt(6) + dthdt(8)) + L5*cos(th(2))*sin(th(4))*sin(th(6) + th(8))*dthdt(2) + L5*cos(th(4))*sin(th(2))*sin(th(6) + th(8))*dthdt(4) + L5*sin(th(2))*sin(th(4))*cos(th(6) + th(8))*(dthdt(6) + dthdt(8));
                                                                                                                                                                                                                                                                                                                                                                                            0,                     sin(th(2))*(L4*sin(th(6)) + L5*sin(th(6) + th(8)))*dthdt(2) - cos(th(2))*(L4*cos(th(6))*dthdt(6) + L5*cos(th(6) + th(8))*dthdt(6) + L5*cos(th(6) + th(8))*dthdt(8)) + sin(th(2))*sin(th(4))*(L5*sin(th(6) + th(8))*dthdt(6) + L5*sin(th(6) + th(8))*dthdt(8) + L4*sin(th(6))*dthdt(6)) - cos(th(2))*sin(th(4))*(L5*cos(th(6) + th(8)) + L4*cos(th(6)))*dthdt(2) - cos(th(4))*sin(th(2))*(L5*cos(th(6) + th(8)) + L4*cos(th(6)))*dthdt(4),                                                                                                                                                                                                                                     0,              - cos(th(2))*cos(th(4))*(L5*sin(th(6) + th(8))*dthdt(6) + L5*sin(th(6) + th(8))*dthdt(8) + L4*sin(th(6))*dthdt(6)) - cos(th(4))*sin(th(2))*(L5*cos(th(6) + th(8)) + L4*cos(th(6)))*dthdt(2) - cos(th(2))*sin(th(4))*(L5*cos(th(6) + th(8)) + L4*cos(th(6)))*dthdt(4),                                                                                                                                                                                                                                                                                                                                                                                    0,                     sin(th(2))*(L5*sin(th(6) + th(8))*dthdt(6) + L5*sin(th(6) + th(8))*dthdt(8) + L4*sin(th(6))*dthdt(6)) - cos(th(2))*(L5*cos(th(6) + th(8)) + L4*cos(th(6)))*dthdt(2) - cos(th(2))*sin(th(4))*(L4*cos(th(6))*dthdt(6) + L5*cos(th(6) + th(8))*dthdt(6) + L5*cos(th(6) + th(8))*dthdt(8)) - cos(th(2))*cos(th(4))*(L4*sin(th(6)) + L5*sin(th(6) + th(8)))*dthdt(4) + sin(th(2))*sin(th(4))*(L4*sin(th(6)) + L5*sin(th(6) + th(8)))*dthdt(2),                                                                                                                                                                                                                                               0,              L5*sin(th(2))*sin(th(6) + th(8))*(dthdt(6) + dthdt(8)) - L5*cos(th(2))*cos(th(6) + th(8))*dthdt(2) - L5*cos(th(2))*cos(th(4))*sin(th(6) + th(8))*dthdt(4) + L5*sin(th(2))*sin(th(4))*sin(th(6) + th(8))*dthdt(2) - L5*cos(th(2))*sin(th(4))*cos(th(6) + th(8))*(dthdt(6) + dthdt(8));
                                                                                                                                                                                                                                                                                                                                                                                            0,                                                                                                                                                                                                                                                                                                                                                                                    0,                                                                                                                                                                                                                                     0,                                                                                               cos(th(4))*(L5*cos(th(6) + th(8)) + L4*cos(th(6)))*dthdt(4) - sin(th(4))*(L5*sin(th(6) + th(8))*dthdt(6) + L5*sin(th(6) + th(8))*dthdt(8) + L4*sin(th(6))*dthdt(6)),                                                                                                                                                                                                                                                                                                                                                                                    0,                                                                                                                                                                                                                                              cos(th(4))*(L4*cos(th(6))*dthdt(6) + L5*cos(th(6) + th(8))*dthdt(6) + L5*cos(th(6) + th(8))*dthdt(8)) - sin(th(4))*(L4*sin(th(6)) + L5*sin(th(6) + th(8)))*dthdt(4),                                                                                                                                                                                                                                               0,                                                                                                                                                                L5*cos(th(4))*cos(th(6) + th(8))*(dthdt(6) + dthdt(8)) - L5*sin(th(4))*sin(th(6) + th(8))*dthdt(4);
                                                                                                                                                                                                                                                                                                                                                                                            0,                                                                                                                                                                                                                                                                                                                                                                                    0,                                                                                                                                                                                                                                     0,                                                                                                                                                                                                                                     0,                                                                                                                                                                                                                                                                                                                                                                                    0,                                                                                                                                                                                                                                                                                                                                                                      cos(th(4))*dthdt(4),                                                                                                                                                                                                                                               0,                                                                                                                                                                                                                                 cos(th(4))*dthdt(4);
                             sin(th(1))*(L4*cos(th(5))*dthdt(5) + L5*cos(th(5) + th(7))*dthdt(5) + L5*cos(th(5) + th(7))*dthdt(7)) + cos(th(1))*(L4*sin(th(5)) + L5*sin(th(5) + th(7)))*dthdt(1) + cos(th(1))*sin(th(3))*(L5*sin(th(5) + th(7))*dthdt(5) + L5*sin(th(5) + th(7))*dthdt(7) + L4*sin(th(5))*dthdt(5)) - cos(th(1))*cos(th(3))*(L5*cos(th(5) + th(7)) + L4*cos(th(5)))*dthdt(3) + sin(th(1))*sin(th(3))*(L5*cos(th(5) + th(7)) + L4*cos(th(5)))*dthdt(1),                                                                                                                                                                                                                                                                                                                                                                                    0,                cos(th(3))*sin(th(1))*(L5*sin(th(5) + th(7))*dthdt(5) + L5*sin(th(5) + th(7))*dthdt(7) + L4*sin(th(5))*dthdt(5)) - cos(th(1))*cos(th(3))*(L5*cos(th(5) + th(7)) + L4*cos(th(5)))*dthdt(1) + sin(th(1))*sin(th(3))*(L5*cos(th(5) + th(7)) + L4*cos(th(5)))*dthdt(3),                                                                                                                                                                                                                                     0,                     cos(th(1))*(L5*sin(th(5) + th(7))*dthdt(5) + L5*sin(th(5) + th(7))*dthdt(7) + L4*sin(th(5))*dthdt(5)) + sin(th(1))*(L5*cos(th(5) + th(7)) + L4*cos(th(5)))*dthdt(1) + sin(th(1))*sin(th(3))*(L4*cos(th(5))*dthdt(5) + L5*cos(th(5) + th(7))*dthdt(5) + L5*cos(th(5) + th(7))*dthdt(7)) + cos(th(1))*sin(th(3))*(L4*sin(th(5)) + L5*sin(th(5) + th(7)))*dthdt(1) + cos(th(3))*sin(th(1))*(L4*sin(th(5)) + L5*sin(th(5) + th(7)))*dthdt(3),                                                                                                                                                                                                                                                                                                                                                                                    0,              L5*sin(th(1))*cos(th(5) + th(7))*dthdt(1) + L5*cos(th(1))*sin(th(5) + th(7))*(dthdt(5) + dthdt(7)) + L5*cos(th(1))*sin(th(3))*sin(th(5) + th(7))*dthdt(1) + L5*cos(th(3))*sin(th(1))*sin(th(5) + th(7))*dthdt(3) + L5*sin(th(1))*sin(th(3))*cos(th(5) + th(7))*(dthdt(5) + dthdt(7)),                                                                                                                                                                                                                                               0;
                             sin(th(1))*(L4*sin(th(5)) + L5*sin(th(5) + th(7)))*dthdt(1) - cos(th(1))*(L4*cos(th(5))*dthdt(5) + L5*cos(th(5) + th(7))*dthdt(5) + L5*cos(th(5) + th(7))*dthdt(7)) + sin(th(1))*sin(th(3))*(L5*sin(th(5) + th(7))*dthdt(5) + L5*sin(th(5) + th(7))*dthdt(7) + L4*sin(th(5))*dthdt(5)) - cos(th(1))*sin(th(3))*(L5*cos(th(5) + th(7)) + L4*cos(th(5)))*dthdt(1) - cos(th(3))*sin(th(1))*(L5*cos(th(5) + th(7)) + L4*cos(th(5)))*dthdt(3),                                                                                                                                                                                                                                                                                                                                                                                    0,              - cos(th(1))*cos(th(3))*(L5*sin(th(5) + th(7))*dthdt(5) + L5*sin(th(5) + th(7))*dthdt(7) + L4*sin(th(5))*dthdt(5)) - cos(th(3))*sin(th(1))*(L5*cos(th(5) + th(7)) + L4*cos(th(5)))*dthdt(1) - cos(th(1))*sin(th(3))*(L5*cos(th(5) + th(7)) + L4*cos(th(5)))*dthdt(3),                                                                                                                                                                                                                                     0,                     sin(th(1))*(L5*sin(th(5) + th(7))*dthdt(5) + L5*sin(th(5) + th(7))*dthdt(7) + L4*sin(th(5))*dthdt(5)) - cos(th(1))*(L5*cos(th(5) + th(7)) + L4*cos(th(5)))*dthdt(1) - cos(th(1))*sin(th(3))*(L4*cos(th(5))*dthdt(5) + L5*cos(th(5) + th(7))*dthdt(5) + L5*cos(th(5) + th(7))*dthdt(7)) - cos(th(1))*cos(th(3))*(L4*sin(th(5)) + L5*sin(th(5) + th(7)))*dthdt(3) + sin(th(1))*sin(th(3))*(L4*sin(th(5)) + L5*sin(th(5) + th(7)))*dthdt(1),                                                                                                                                                                                                                                                                                                                                                                                    0,              L5*sin(th(1))*sin(th(5) + th(7))*(dthdt(5) + dthdt(7)) - L5*cos(th(1))*cos(th(5) + th(7))*dthdt(1) - L5*cos(th(1))*cos(th(3))*sin(th(5) + th(7))*dthdt(3) + L5*sin(th(1))*sin(th(3))*sin(th(5) + th(7))*dthdt(1) - L5*cos(th(1))*sin(th(3))*cos(th(5) + th(7))*(dthdt(5) + dthdt(7)),                                                                                                                                                                                                                                               0;
                                                                                                                                                                                                                                                                                                                                                                                            0,                                                                                                                                                                                                                                                                                                                                                                                    0,                                                                                               cos(th(3))*(L5*cos(th(5) + th(7)) + L4*cos(th(5)))*dthdt(3) - sin(th(3))*(L5*sin(th(5) + th(7))*dthdt(5) + L5*sin(th(5) + th(7))*dthdt(7) + L4*sin(th(5))*dthdt(5)),                                                                                                                                                                                                                                     0,                                                                                                                                                                                                                                              cos(th(3))*(L4*cos(th(5))*dthdt(5) + L5*cos(th(5) + th(7))*dthdt(5) + L5*cos(th(5) + th(7))*dthdt(7)) - sin(th(3))*(L4*sin(th(5)) + L5*sin(th(5) + th(7)))*dthdt(3),                                                                                                                                                                                                                                                                                                                                                                                    0,                                                                                                                                                                L5*cos(th(3))*cos(th(5) + th(7))*(dthdt(5) + dthdt(7)) - L5*sin(th(3))*sin(th(5) + th(7))*dthdt(3),                                                                                                                                                                                                                                               0;
                                                                                                                                                                                                                                                                                                                                                                                            0,                                                                                                                                                                                                                                                                                                                                                                                    0,                                                                                                                                                                                                                                     0,                                                                                                                                                                                                                                     0,                                                                                                                                                                                                                                                                                                                                                                      cos(th(3))*dthdt(3),                                                                                                                                                                                                                                                                                                                                                                                    0,                                                                                                                                                                                                                                 cos(th(3))*dthdt(3),                                                                                                                                                                                                                                               0];

end